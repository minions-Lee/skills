---
name: transcript-summarizer
version: "1.0.0"
description: |
  将播客/视频逐字稿总结为结构化、专业、客观的摘要文档。支持长逐字稿（9000+ 行）的
  分块处理和多轮分析。融合金字塔原理、SCQA 框架和渐进式总结法。
  输出包含核心论点、章节摘要、关键洞察、名言金句、资源清单和行动建议。
  触发词：总结、摘要、逐字稿总结、transcript summary、summarize、
  总结播客、播客摘要、内容提炼、podcast summary、总结一下。
user-invocable: true
allowed-tools:
  - Bash
  - Read
  - Write
  - Glob
---

# 逐字稿总结 Skill (Transcript Summarizer)

将播客/视频逐字稿总结为结构化、专业、客观的摘要文档。支持超长内容（9000+ 行），融合多种专业总结方法论。

## 方法论基础

本 Skill 融合以下专业总结框架：

| 框架 | 来源 | 本 Skill 中的应用 |
|------|------|-------------------|
| 金字塔原理 | Barbara Minto | 核心结论置顶，支撑论点分组，MECE 分类 |
| SCQA | McKinsey | 情境-矛盾-问题-答案 框架化上下文 |
| 渐进式总结 | Tiago Forte | 逐层提炼：全文 → 关键段 → 核心 → 执行摘要 |
| Q/E/C | 学术研究 | 问题/证据/结论，适用于对话类内容 |
| In Vivo Coding | 质性研究 | 使用说话者原话，保证客观性 |

## 客观性原则

**总结过程中必须严格遵守**：

1. **引用原话**（In Vivo Coding）：关键观点尽量引用说话者原文
2. **事实与观点分离**：明确标注哪些是事实陈述，哪些是个人见解
3. **全视角呈现**：包含所有观点，不偏向多数或权威
4. **避免主观修饰词**：不使用"精彩""震撼""深刻"等情感化语言
5. **归属明确**：每个观点标注出自谁（主播/嘉宾/特定发言人）

## 输入与输出

| 文件 | 角色 | 说明 |
|------|------|------|
| `{标题}.txt` | **必需输入** | Whisper 生成的逐字稿（纯文本，每行一句） |
| `{标题}_shownotes.md` | 辅助输入（强烈推荐） | 平台提供的 Shownotes（含时间戳、嘉宾信息、引用来源） |
| `{标题}_总结.md` | **输出** | 结构化总结文档，保存在与逐字稿同一目录 |

## 完整流程概览

```
① 定位文件 → 统计行数 → 读取 Shownotes（如有）
② 读取开头 → 检测内容类型（访谈/独白/圆桌）→ 确定分析策略
③ 分块读取逐字稿 → 每块提取结构化摘要
④ 跨块合并 → 去重 → 对齐 Shownotes 章节
⑤ 深度主题分析 → 提炼洞察与框架
⑥ 最终合成 → 输出结构化总结文档
```

---

## Workflow

### Step 0: 定位文件与环境准备

1. 确认逐字稿 `.txt` 文件路径。如用户只提供文件夹，用 Glob 查找 `.txt` 文件
2. 统计逐字稿行数：

```bash
wc -l "逐字稿文件路径"
```

3. 检查同目录下是否存在 `_shownotes.md`：

```bash
ls "${逐字稿所在目录}/"*_shownotes.md 2>/dev/null
```

4. 如果存在 Shownotes，用 Read 读取全文。提取：
   - 播客名称、嘉宾信息、节目时长
   - **时间戳章节列表**（定义内容的逻辑分段）
   - 引用的书籍、人物、概念
   - 嘉宾原创框架/模型

5. 确定输出路径：`{逐字稿所在目录}/{原始标题}_总结.md`

### Step 1: 内容类型检测

用 Read 读取逐字稿前 200 行（约开场 5-10 分钟），判断内容类型：

| 内容类型 | 检测特征 | 分析策略 |
|----------|----------|----------|
| **访谈/对话** | 两人交替发言，有"你/您"称呼，开场介绍嘉宾 | 追踪主客观点，标注发言人，提取共识与分歧 |
| **独白/演讲** | 单一叙述声音，论点推进式结构 | 聚焦论证脉络：主论点 → 支撑论据 → 结论 |
| **圆桌/多人** | 三人以上发言，主持人引导讨论 | 追踪各方立场，标注共识 vs. 分歧 |

同时从开头提取：节目名称、主播/嘉宾姓名、嘉宾背景、本期话题预告。

### Step 2: 分块读取与逐块摘要

#### 分块策略

| 逐字稿行数 | 方案 |
|------------|------|
| < 1500 行 | 不分块，直接全文处理（跳到 Step 4） |
| 1500-4000 | 分 2 块，每块 ~2000 行 |
| 4000-8000 | 分 4 块，每块 ~2000 行 |
| > 8000 行 | 分 N 块（N = ceil(行数/1800)），相邻块重叠 200 行 |

> 相邻块重叠 200 行（约 3-5 分钟对话），防止话题在块边界被切断。

#### 每块提取内容

对每一块用 Read 读取后，执行以下结构化提取：

**A. 话题段落**（本块包含的 2-5 个主要讨论主题）
- 每个话题：一句话标题 + 3-5 句概括
- 如能对应 Shownotes 时间戳章节，标注对应章节

**B. 关键观点**（按发言人归属）
- 格式：【发言人】观点内容（引用原话）
- 区分事实陈述 vs. 个人见解

**C. 名言金句**
- 引用原话，标注发言人
- 只选择真正有洞察力、可独立引用的句子

**D. 提及的资源**
- 书籍、文章、人物、概念、工具等
- 格式：类型 | 名称 | 发言人 | 上下文

**E. 共识与分歧**（仅访谈/圆桌类型）
- 发言人之间的观点差异和一致之处

> 每块结果保持在内存中，不写入中间文件。

### Step 3: 跨块合并

所有块摘要提取完成后，执行合并：

1. **去重**：重叠区域的重复内容只保留一次
2. **话题连续性**：同一话题跨越多块时，合并为完整描述
3. **对齐 Shownotes 章节**：
   - 将话题段落与 Shownotes 时间戳章节一一对齐
   - Shownotes 有但摘要遗漏的章节，标记为需补充
   - 逐字稿有但 Shownotes 未提及的话题，保留（可能是即兴讨论）
4. **资源去重**：相同书籍/人物只保留一条，合并上下文
5. **金句去重**：意思相同的金句只保留表述最清晰的版本

合并后形成**统一中间摘要**：完整话题列表、全部关键观点、金句、资源清单、共识与分歧。

### Step 4: 深度主题分析

在中间摘要基础上进行高阶分析：

**A. 核心论点提炼（金字塔原理）**
- 一句话概括核心结论
- 3-5 个一级论点，每个下设 2-3 个支撑证据/案例
- 论点之间 MECE（互不重叠、完全穷尽）

**B. SCQA 框架化**
- Situation（情境）：讨论发生的背景/时代语境
- Complication（矛盾）：核心张力或挑战
- Question（问题）：本期要回答的核心问题
- Answer（答案）：讨论得出的回答或方向

**C. 可行洞察（Actionable Insights）**
- 听众可直接应用的建议，不超过 5 条
- 格式：洞察标题 + 具体做法 + 来源归属

**D. 嘉宾原创框架/模型（如有）**
- 完整呈现嘉宾提出的独创性思考框架，不做简化

### Step 5: 最终合成与输出

将所有分析结果按以下模板合成最终 Markdown 文件，用 Write 保存：

---

## 输出模板

```markdown
# {节目名称}｜{本期标题}

> **播客**: {播客名} | **嘉宾**: {嘉宾姓名}（{身份/头衔}）
> **时长**: {时长} | **内容类型**: {访谈/独白/圆桌}
> **原始逐字稿**: {行数} 行 | **总结方法**: 金字塔原理 + SCQA + 渐进式总结

---

## 执行摘要

{100-200 字的核心概括。使用金字塔原理：核心结论在前，支撑要点在后。
回答"这期节目讲了什么，最重要的结论是什么"。}

## SCQA 框架

| 要素 | 内容 |
|------|------|
| **情境 (S)** | {时代背景/讨论语境} |
| **矛盾 (C)** | {核心张力/挑战} |
| **问题 (Q)** | {要回答的核心问题} |
| **答案 (A)** | {讨论得出的回答/方向} |

## 核心论点结构

**中心论点**：{一句话}

1. **{一级论点 1}**
   - {支撑证据/案例 a}
   - {支撑证据/案例 b}
2. **{一级论点 2}**
   - {支撑证据/案例 a}
   - {支撑证据/案例 b}
3. **{一级论点 3}**
   - {支撑证据/案例 a}
   - {支撑证据/案例 b}

## 章节摘要

### {章节 1 标题}（{时间戳，如有}）

{3-5 句概括}

**关键观点**：
- 【{发言人}】{观点，引用原话}
- 【{发言人}】{观点}

### {章节 2 标题}（{时间戳}）
...（逐章节展开）

## 关键洞察

1. **{洞察标题}**
   {2-3 句展开，标注来源发言人}

2. **{洞察标题}**
   {2-3 句展开}

## 可行建议

- [ ] **{建议标题}**：{具体做法}（来源：{发言人}）
- [ ] **{建议标题}**：{具体做法}

## 名言金句

> "{原话}"
> — {发言人}

> "{原话}"
> — {发言人}

## 嘉宾原创框架

### {框架名称}
{完整呈现嘉宾提出的思考框架/模型}

## 资源清单

### 书籍
| 书名 | 作者 | 推荐人 | 讨论语境 |
|------|------|--------|----------|

### 人物/概念
| 名称 | 类型 | 提及语境 |
|------|------|----------|

## 共识与分歧

### 共识
- {双方/多方一致认同的观点}

### 分歧
- {观点差异，标注各方立场}

---
*本总结由 transcript-summarizer skill 生成*
*方法论：金字塔原理 (Minto) + SCQA + 渐进式总结 (Forte) + In Vivo Coding*
*原始文件：{逐字稿文件名}*
```

---

## Whisper 逐字稿质量处理

| 问题 | 表现 | 处理方式 |
|------|------|----------|
| 开头重复 | "中文字幕参与" 重复多次 | 识别并跳过，不纳入分析 |
| 同音字错误 | "谁也数字化转型" | 结合上下文推断原意，总结中使用正确表述 |
| 无说话者标记 | 所有文字连续无标记 | 结合 Shownotes 嘉宾信息和对话线索推断发言人 |
| 句子碎片化 | 一句话被拆成多行 | 合并理解，不逐行分析 |

## 无 Shownotes 的情况

- 章节划分完全依赖逐字稿内容本身的话题转换
- 嘉宾信息从逐字稿开场白中提取
- 资源清单仅从逐字稿直接提及的内容提取
- 在输出中标注"本总结未使用 Shownotes 辅助信息"

## 与 video-downloader 集成

被动集成，不修改 video-downloader。用户下载完成后说"总结一下"即可触发：

```
主题文件夹/
├── {标题}.m4a              （音频）
├── {标题}.txt               （逐字稿）← 本 Skill 输入
├── {标题}_shownotes.md      （Shownotes）← 辅助输入
└── {标题}_总结.md           ← 本 Skill 输出
```

## 完成报告

输出文件后，向用户展示：

```
总结完成

输出文件：{路径}/{原始标题}_总结.md
逐字稿规模：{行数} 行，分 {N} 块处理
内容类型：{访谈/独白/圆桌}
章节数：{N} 章
关键洞察：{N} 条
提及资源：{N} 项
```

## Troubleshooting

| 问题 | 解决方案 |
|------|----------|
| 逐字稿太长导致处理中断 | 减少每块行数至 1500，增加块数 |
| 无法确定发言人 | 标注"发言人不确定"，不做猜测 |
| Shownotes 与逐字稿内容不匹配 | 以逐字稿实际内容为准，Shownotes 仅作参考 |
| 找不到逐字稿文件 | 提示用户提供完整文件路径 |

## 参考文献

- Minto, B. *The Pyramid Principle*. Pearson Education.
- Forte, T. *Building a Second Brain*. Atria Books. (Progressive Summarization)
- Pauk, W. *How to Study in College* (Cornell Note-Taking Method)
- Saldana, J. *The Coding Manual for Qualitative Researchers* (In Vivo Coding)
