<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Logic Workbench</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f8fafc;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .controls {
            margin-bottom: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        button:hover {
            opacity: 0.9;
        }

        button.secondary {
            background: #e2e8f0;
            color: #475569;
        }

        #canvas-container {
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 8px;
            overflow: hidden;
            background: white;
            display: inline-block;
            /* Fit content */
        }

        #product-image {
            display: block;
            max-width: 100%;
            height: auto;
            pointer-events: none;
            /* Prevent image dragging */
        }

        .annotation-card {
            position: absolute;
            top: 20px;
            /* Default initial pos */
            left: 20px;
            width: 250px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 12px;
            cursor: grab;
            z-index: 10;
            transition: box-shadow 0.2s, transform 0.1s;
        }

        .annotation-card:active {
            cursor: grabbing;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.15);
            transform: scale(1.02);
            z-index: 20;
            /* Bring to front */
        }

        /* Clean Mode: Hide handles/borders if we had them, purely cleaner look */
        body.clean-mode .controls {
            opacity: 0;
            pointer-events: none;
        }

        body.clean-mode {
            padding: 0;
            background: white;
        }

        body.clean-mode #canvas-container {
            box-shadow: none;
            border-radius: 0;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .card-number {
            background: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .card-content {
            font-size: 14px;
            color: #334155;
            line-height: 1.5;
        }

        #regions-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 5;
        }

        .region-box {
            position: absolute;
            border: 2px dashed rgba(37, 99, 235, 0.75);
            background: rgba(37, 99, 235, 0.08);
            border-radius: 8px;
            box-sizing: border-box;
        }

        .region-label {
            position: absolute;
            top: 0;
            left: 0;
            transform: translateY(-100%);
            background: rgba(37, 99, 235, 0.95);
            color: #fff;
            font-size: 12px;
            line-height: 1.3;
            padding: 6px 8px;
            border-radius: 6px;
            max-width: 220px;
            box-shadow: 0 6px 12px rgba(15, 23, 42, 0.2);
        }

        .region-label strong {
            display: block;
            font-size: 12px;
            font-weight: 700;
        }

        .region-label small {
            display: block;
            font-size: 11px;
            opacity: 0.95;
        }

        body.hide-regions #regions-layer {
            display: none;
        }

        body.hide-cards .annotation-card {
            display: none;
        }
    </style>
</head>

<body>

    <div class="controls">
        <button onclick="toggleCleanMode()">üëÅ Toggle Clean Mode (for Screenshot)</button>
        <button class="secondary" onclick="toggleRegions()">üß≠ Toggle Regions</button>
        <button class="secondary" onclick="toggleCards()">üìù Toggle Cards</button>
        <button class="secondary" onclick="resetPositions()">‚Ü∫ Reset Positions</button>
        <span style="margin-left: 10px; color: #64748b; font-size: 12px;">Drag cards to position them</span>
    </div>

    <div id="canvas-container">
        <div id="regions-layer"></div>
        <img id="product-image" src="/var/folders/y7/b1l152jx6ks9rzw684xlc3kc0000gn/T/codex-clipboard-gMam2e.png" alt="Product Screenshot">
        <!-- Annotations will be injected here -->
    </div>

    <script>
        const annotations = ["1. È°∂ÈÉ®ÂØºËà™Ê†èÂåÖÂê´ËøîÂõû‰∏éÂàÜ‰∫´/Êõ¥Â§öÂÖ•Âè£", "2. ÂïÜÂìÅ‰∏ªÂõæÊîØÊåÅÂ§öÂõæËΩÆÊí≠ÔºåÂè≥‰∏ãËßíÂ±ïÁ§∫ÂΩìÂâçÂº†Êï∞ÔºàÂ¶Ç 1/5Ôºâ", "3. ÂïÜÂìÅÊ†áÈ¢òÂ±ïÁ§∫ÂìÅÁâå+ÂûãÂè∑+ËßÑÊ†ºÔºåË∂ÖÈïøËá™Âä®Êç¢Ë°å", "4. ‰ª∑Ê†º/ÊùÉÁõäÊ†áÁ≠æ‰ª•ÈÜíÁõÆÈ¢úËâ≤Â±ïÁ§∫ÔºàÂ¶ÇÂèØÈôç‰ª∑„ÄÅÂèØÊØî‰ª∑„ÄÅÂèØÊî∂ËóèÔºâ", "5. ‰∏ªÊìç‰ΩúÂå∫Êèê‰æõÈôç‰ª∑ÊèêÈÜí/Êî∂ËóèÁ≠âÂø´Êç∑Êìç‰Ωú", "6. È°∂ÈÉ® TabÔºöÊé®Ëçê/‰ª∑Ê†ºË∂ãÂäø/ÂïÜÂìÅËØÑ‰ª∑ÔºåÂèØÂàáÊç¢Âπ∂ÈîöÁÇπÊªöÂä®", "7. Êé®ËçêÂàóË°®Êåâ‰ª∑Ê†ºÊéíÂ∫èÔºåÂ±ïÁ§∫Âπ≥Âè∞ Logo„ÄÅ‰ª∑Ê†º„ÄÅÂ∑Æ‰ª∑/‰ºòÊÉ†‰ø°ÊÅØ", "8. Êé®ËçêÈ°πÊîØÊåÅË∑≥ËΩ¨Âà∞ÂØπÂ∫îÁîµÂïÜË¥≠‰π∞", "9. ‰ª∑Ê†ºËµ∞ÂäøÂå∫Â±ïÁ§∫Êó∂Èó¥ËåÉÂõ¥‰∏éÊäòÁ∫øÂõæ", "10. ËØÑ‰ª∑Âå∫Â±ïÁ§∫Áî®Êà∑Â§¥ÂÉè„ÄÅÊòµÁß∞„ÄÅÊó∂Èó¥‰∏éÂÜÖÂÆπ", "11. ËØÑ‰ª∑Âå∫Êèê‰æõÊü•ÁúãÊõ¥Â§öÂÖ•Âè£", "12. ÂÖ≥ÈîÆÂå∫ÂùóÈöèÊªöÂä®‰øùÊåÅÁªìÊûÑÁ®≥ÂÆöÔºå‰∏çÈÅÆÊå°Â∫ïÈÉ®Êìç‰Ωú"];
        const container = document.getElementById('canvas-container');
        const regionsLayer = document.getElementById('regions-layer');
        const productImage = document.getElementById('product-image');
        const regions = [
            {
                id: 1,
                title: 'È°∂ÈÉ®ÂØºËà™',
                note: 'ËøîÂõû/ÂàÜ‰∫´ÂÖ•Âè£Âõ∫ÂÆöÂèØÁî®ÔºåÈÅøÂÖçË¢´Áä∂ÊÄÅÊ†èÈÅÆÊå°',
                rect: { x: 0, y: 0, w: 358, h: 90 },
            },
            {
                id: 2,
                title: 'ÂïÜÂìÅ‰∏ªÂõæ',
                note: 'ËΩÆÊí≠‰∏éÂº†Êï∞ÊèêÁ§∫‰∏ÄËá¥ÔºåÊîØÊåÅÂ∑¶Âè≥ÊªëÂä®',
                rect: { x: 0, y: 90, w: 358, h: 280 },
            },
            {
                id: 3,
                title: 'ÂïÜÂìÅ‰ø°ÊÅØÂå∫',
                note: 'Ê†áÈ¢ò/ËßÑÊ†º/Ê†áÁ≠æÂÆåÊï¥Â±ïÁ§∫ÔºåË∂ÖÈïøËá™Âä®Êç¢Ë°å',
                rect: { x: 0, y: 370, w: 358, h: 190 },
            },
            {
                id: 4,
                title: 'Âø´Êç∑Êìç‰Ωú',
                note: 'Èôç‰ª∑ÊèêÈÜí/Êî∂ËóèÁ≠â‰∏ªÊìç‰ΩúÂèØËßÅ‰∏îÂèØÁî®',
                rect: { x: 0, y: 520, w: 358, h: 80 },
            },
            {
                id: 5,
                title: 'ÂÜÖÂÆπ Tab',
                note: 'Êé®Ëçê/‰ª∑Ê†ºË∂ãÂäø/ËØÑ‰ª∑ÂàáÊç¢ÈîöÁÇπÂáÜÁ°Æ',
                rect: { x: 0, y: 600, w: 358, h: 70 },
            },
            {
                id: 6,
                title: 'Êé®ËçêÂàóË°®',
                note: 'Êåâ‰ª∑Ê†ºÊéíÂ∫èÔºåÂ±ïÁ§∫Âπ≥Âè∞‰∏éË∑≥ËΩ¨Ë¥≠‰π∞',
                rect: { x: 0, y: 670, w: 358, h: 340 },
            },
            {
                id: 7,
                title: '‰ª∑Ê†ºËµ∞Âäø',
                note: 'Êó∂Èó¥ËåÉÂõ¥‰∏éÊäòÁ∫øÂõæ‰∏ÄËá¥ÔºåÊï∞ÊçÆÂèØËØª',
                rect: { x: 0, y: 1010, w: 358, h: 250 },
            },
            {
                id: 8,
                title: 'Áî®Êà∑ËØÑ‰ª∑',
                note: 'Â§¥ÂÉè/ÊòµÁß∞/Êó∂Èó¥/ÂÜÖÂÆπÈΩêÂÖ®ÔºåÊü•ÁúãÊõ¥Â§öÂèØËøõ',
                rect: { x: 0, y: 1260, w: 358, h: 350 },
            },
            {
                id: 9,
                title: 'Â∫ïÈÉ®‰∫§‰∫í',
                note: 'ÂèëË°®ËØÑËÆ∫ÂÖ•Âè£Ê∏ÖÊô∞ÔºåÈÅøÂÖçÈÅÆÊå°ÂÜÖÂÆπ',
                rect: { x: 0, y: 1610, w: 358, h: 138 },
            },
        ];

        // Initialize Annotations
        annotations.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'annotation-card';
            card.style.top = (50 + index * 120) + 'px'; // Stagger them initially
            card.style.left = '50px';

            // Allow manual override override if text is object
            const text = typeof item === 'string' ? item : (item.text || JSON.stringify(item));

            card.innerHTML = `
                <div class="card-header">
                    <div class="card-number">${index + 1}</div>
                    <div style="font-weight:600; color:#1e293b;">Logic Point</div>
                </div>
                <div class="card-content" contenteditable="true">${text}</div>
            `;

            makeDraggable(card);
            container.appendChild(card);
        });

        function toggleRegions() {
            document.body.classList.toggle('hide-regions');
        }

        function toggleCards() {
            document.body.classList.toggle('hide-cards');
        }

        function renderRegions() {
            if (!productImage.complete) return;
            const scaleX = productImage.clientWidth / productImage.naturalWidth;
            const scaleY = productImage.clientHeight / productImage.naturalHeight;
            regionsLayer.style.width = `${productImage.clientWidth}px`;
            regionsLayer.style.height = `${productImage.clientHeight}px`;
            regionsLayer.innerHTML = '';

            regions.forEach((region) => {
                const box = document.createElement('div');
                box.className = 'region-box';
                box.style.left = `${region.rect.x * scaleX}px`;
                box.style.top = `${region.rect.y * scaleY}px`;
                box.style.width = `${region.rect.w * scaleX}px`;
                box.style.height = `${region.rect.h * scaleY}px`;
                box.style.position = 'absolute';
                box.style.boxSizing = 'border-box';

                const label = document.createElement('div');
                label.className = 'region-label';
                label.innerHTML = `<strong>${region.id}. ${region.title}</strong><small>${region.note}</small>`;
                box.appendChild(label);

                regionsLayer.appendChild(box);
            });
        }

        productImage.addEventListener('load', renderRegions);
        window.addEventListener('resize', renderRegions);
        renderRegions();

        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            element.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                // Allow text selection inside contenteditable
                if (e.target.getAttribute('contenteditable')) return;

                e = e || window.event;
                e.preventDefault();
                // get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // set the element's new position:
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                // stop moving when mouse button is released:
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        function toggleCleanMode() {
            document.body.classList.toggle('clean-mode');
        }

        function resetPositions() {
            const cards = document.querySelectorAll('.annotation-card');
            cards.forEach((card, index) => {
                card.style.top = (50 + index * 120) + 'px';
                card.style.left = '50px';
            });
        }
    </script>
</body>

</html>
