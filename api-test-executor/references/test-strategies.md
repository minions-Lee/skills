# 测试范围划分策略

## 目录

- [策略 1：按业务模块](#策略-1按业务模块划分)
- [策略 2：按优先级/风险等级](#策略-2按优先级风险等级划分)
- [策略 3：按变更 Diff](#策略-3按变更-diff-划分)
- [策略 4：按覆盖矩阵](#策略-4按接口覆盖矩阵划分)
- [策略 5：按依赖链路](#策略-5按依赖链路划分)
- [策略组合推荐](#策略组合推荐)
- [交互式范围选择](#交互式范围选择)

---

## 策略 1：按业务模块划分

扫描 Controller/Router 文件，按包名或路径前缀自动分组，输出模块清单让用户选择。

**自动分组规则**：

| 语言 | 分组依据 |
|------|---------|
| Java | `controller` 包下的类名（`UserController` → 用户模块） |
| Python | `routes/` 或 `views/` 下的文件名 |
| Go | `handler/` 下的文件名 |
| Node.js | `routes/` 下的文件名 |

## 策略 2：按优先级/风险等级划分

| 等级 | 标准 | 示例 | 测试要求 |
|------|------|------|---------|
| **P0** | 主流程必经，挂了业务不可用 | 登录、下单、支付 | 正向 + 异常 + 边界 |
| **P1** | 高频使用，影响主要体验 | 搜索、订单列表 | 正向 + 主要异常 |
| **P2** | 低频使用，影响有限 | 修改头像、地址管理 | 正向用例 |
| **P3** | 极少使用，有降级方案 | 日志导出、运营配置 | 按需测试 |

**自动推断信号**：

| 信号 | 推断 |
|------|------|
| 被 `dependsOn` 引用多次 | 优先级提升 |
| 路径含 `pay`/`order`/`refund` | P0 |
| 路径含 `login`/`auth`/`token` | P0 |
| 路径含 `admin`/`manage`/`config` | P2-P3 |
| 方法为 DELETE | 风险提升一级 |

## 策略 3：按变更 Diff 划分

```
git diff --name-only HEAD~1
  → 筛选变更的 Controller/Service/DTO 文件
  → 反向追踪影响到哪些接口
  → 只执行这些接口的用例
```

**变更追踪规则**：

| 变更文件类型 | 影响范围 |
|-------------|---------|
| Controller / Router | 直接影响：该文件中的所有接口 |
| Service / UseCase | 间接影响：调用该 Service 的所有 Controller 接口 |
| DTO / VO / Model | 间接影响：使用该 DTO 的接口 |
| Repository / DAO | 间接影响：依赖该数据层的 Service → Controller |
| 配置文件 / 中间件 | 全局影响：建议全量回归 |

## 策略 4：按接口覆盖矩阵划分

```markdown
| 接口 | 正向 | 参数校验 | 鉴权 | 权限 | 幂等 |
|------|------|---------|------|------|------|
| POST /users/register | ✅ | ✅ | - | - | ✅ |
| POST /orders | ✅ | ✅ | ✅ | ✅ | ✅ |
| DELETE /orders/{id} | ✅ | - | ✅ | ✅ | ✅ |
```

扫描所有接口 + 现有用例 → 生成矩阵 → 标出空白区域建议补充。

## 策略 5：按依赖链路划分

从入口接口出发，自动追踪整条业务链路：

```
用户："测一下下单流程"
  → 登录 → 获取商品 → 创建订单 → 支付 → 查看状态
```

链路识别：`dependsOn` 关系 + 业务关键词匹配 + 数据依赖（A 输出是 B 输入）。

## 策略组合推荐

| 场景 | 推荐组合 |
|------|---------|
| 首次全量摸底 | 按模块 + 覆盖矩阵 |
| 日常迭代回归 | 按 Diff + P0 必跑 |
| 上线前验收 | P0+P1 + 核心链路 |
| 新功能完成 | 单模块 + 补齐覆盖 |
| 紧急 hotfix | 仅 Diff 涉及接口 |

## 交互式范围选择

用户未指定范围时，展示统计并让用户选择：

```
📊 解析完成，共发现 47 个接口：

  模块              接口数    P0    P1    P2
  ─────────────────────────────────────────
  用户模块           8       2     3     3
  订单模块           10      4     4     2
  ─────────────────────────────────────────
  合计              47      11    16    20

请选择：
1. 全量执行（47 个）
2. 按模块选择
3. 仅 P0（11 个）
4. P0 + P1（27 个）
5. 仅变更涉及（git diff）
6. 按业务链路
7. 自定义
```

无论选择哪种范围，自动补充前置依赖接口。
