# 知识库目录结构与文件模板

## 目录结构

```
project_knowledge/
├── README.md                # 索引文件：项目概述 + 导航 + 置信度统计
├── architecture.md          # 技术架构：技术栈、项目结构、架构决策
├── data-model.md            # 全局数据模型：实体关系图、枚举速查表
├── integrations.md          # 外部集成：第三方服务、MQ、定时任务
├── permissions.md           # 权限体系：角色矩阵、鉴权流程
├── ai-guide.md              # AI 开发指南：业务规则、踩坑清单、命名约定
├── open-questions.md        # 开放问题：未解决的疑问
└── modules/                 # 业务模块（每个模块一个文件）
    ├── user.md
    ├── order.md
    ├── payment.md
    └── ...
```

## 文件拆分原则

| 维度 | 文件 | 内容范围 | 增长特征 |
|------|------|---------|---------|
| 宏观 | `README.md` | 项目定位、状态、用户角色、文件导航 | 稳定，很少变 |
| 宏观 | `architecture.md` | 技术栈、分层、架构决策 | 低频更新 |
| 全局 | `data-model.md` | 所有实体的关系图 + 全局枚举速查表 | 随表结构增长 |
| 全局 | `integrations.md` | 第三方 API、MQ、缓存、定时任务 | 随集成增加 |
| 全局 | `permissions.md` | 角色定义、权限矩阵、鉴权流程 | 中等 |
| **细节** | `modules/{module}.md` | **单个业务模块的全部知识** | **主要增长点** |
| 实操 | `ai-guide.md` | 开发规则、容易踩的坑、命名约定 | 随经验积累 |
| 动态 | `open-questions.md` | 未解决的问题 | 先增后减 |

**核心思路**：全局性内容在顶层文件，业务细节按模块拆分到 `modules/` 下。开发某个模块时只需加载 `README.md` + `architecture.md` + `modules/{module}.md`，不用读完整个知识库。

## 按需创建规则

不是每个项目都需要所有文件：

| 文件 | 创建条件 |
|------|---------|
| `README.md` | **始终创建** |
| `architecture.md` | **始终创建** |
| `modules/*.md` | **始终创建**（至少一个模块） |
| `ai-guide.md` | **始终创建** |
| `open-questions.md` | 有未解决问题时创建 |
| `data-model.md` | 有数据库 / ORM 时创建 |
| `integrations.md` | 有第三方调用 / MQ / 定时任务时创建 |
| `permissions.md` | 有权限/角色体系时创建 |

---

## 各文件模板

### README.md（索引文件）

```markdown
# {项目名称} — 项目知识库

> 生成时间：YYYY-MM-DD
> 知识来源：代码扫描 + 人工问卷 v{N}
> 置信度标记：🟢 已确认 | 🟡 AI 推断 | 🔴 存疑

## 项目概述

### 定位
> {一句话说明项目做什么} 🟢

### 业务领域
> {所属行业/领域} 🟢

### 项目状态
> {开发中 / 已上线 / 维护中} 🟢

### 核心用户角色
| 角色 | 说明 | 主要操作 |
|------|------|---------|
| ... | ... | ... |

## 知识库导航

| 文件 | 内容 | 覆盖度 |
|------|------|--------|
| [architecture.md](architecture.md) | 技术架构与决策 | 🟢 已确认 |
| [data-model.md](data-model.md) | 实体关系与枚举 | 🟡 部分推断 |
| [modules/user.md](modules/user.md) | 用户模块 | 🟢 已确认 |
| [modules/order.md](modules/order.md) | 订单模块 | 🔴 待补全 |
| [ai-guide.md](ai-guide.md) | AI 开发指南 | 🟢 已确认 |
| [open-questions.md](open-questions.md) | 开放问题（N 条） | — |

## 知识覆盖度统计

| 指标 | 值 |
|------|---|
| 已确认知识点 (🟢) | N |
| AI 推断 (🟡) | N |
| 存疑 (🔴) | N |
| 开放问题 | N |
| 模块覆盖 | X / Y |
```

### architecture.md（技术架构）

```markdown
# 技术架构

## 技术栈

| 层级 | 技术 | 版本 | 备注 | 置信度 |
|------|------|------|------|--------|
| 语言 | Java 17 | 17.0.x | — | 🟢 |
| 框架 | Spring Boot | 3.x | — | 🟢 |
| 数据库 | MySQL | 8.0 | 主库 | 🟢 |
| 缓存 | Redis | 7.x | 会话 + 业务缓存 | 🟢 |
| ... | ... | ... | ... | ... |

## 项目结构

​```
{项目目录树，标注每个模块的职责}
​```

## 分层规范

{Controller → Service → Repository 的调用规则、异常处理规范等}

## 架构决策记录

| 决策 | 选择 | 备选方案 | 选择原因 | 置信度 |
|------|------|---------|---------|--------|
| ORM | MyBatis | JPA | 复杂查询多 | 🟢 |
| ... | ... | ... | ... | ... |
```

### data-model.md（全局数据模型）

```markdown
# 数据模型

## 实体关系总览

​```
{文字版 ER 图，展示核心实体间的关系}

User 1──N Order
Order 1──N OrderItem
Order N──1 Payment
​```

## 枚举值速查表

| 枚举类/字段 | 值 | 含义 | 所在模块 | 置信度 |
|------------|---|------|---------|--------|
| order.status | 0 | 待支付 | 订单 | 🟢 |
| order.status | 1 | 已支付 | 订单 | 🟢 |
| user.type | 1 | 普通用户 | 用户 | 🟡 |
| ... | ... | ... | ... | ... |

## 状态机

### {状态字段名}

​```
状态流转图
0(待支付) → 1(已支付) → 2(已发货) → 3(已完成)
         ↘ 4(已取消)
​```

**流转规则**：
| 当前状态 | 可流转到 | 触发条件 | 置信度 |
|---------|---------|---------|--------|
| 0 待支付 | 1 已支付 | 支付回调成功 | 🟢 |
| 0 待支付 | 4 已取消 | 用户取消 / 超时 | 🟢 |
```

### modules/{module}.md（业务模块）

每个模块文件是**自包含的**——读这一个文件就能理解该模块的全貌。

```markdown
# {模块名称}模块

## 模块概述

> {一句话说明模块职责} 🟢

**代码位置**：`{包路径或目录}`
**核心类/文件**：
| 类/文件 | 职责 |
|--------|------|
| OrderController | 订单 API 入口 |
| OrderService | 订单业务逻辑 |
| OrderMapper | 订单数据访问 |

## 核心流程

### {流程名称}

**置信度**：🟢

**完整流程**：
1. 步骤一
2. 步骤二
   - 异常路径 A：...
   - 异常路径 B：...
3. 步骤三

**关键代码位置**：
| 步骤 | 代码位置 |
|------|---------|
| 步骤一 | `OrderService.java:100` |

### {流程名称 2}
...

## 业务规则

| # | 规则 | 代码位置 | 置信度 |
|---|------|---------|--------|
| 1 | 同一用户 24h 内最多下 10 单 | OrderService.java:85 | 🟢 |
| 2 | ... | ... | ... |

## 本模块涉及的实体

| 实体 | 关键字段 | 说明 | 置信度 |
|------|---------|------|--------|
| Order | status(int) | 0待支付 1已支付 2已发货 | 🟢 |
| OrderItem | quantity(int) | 商品数量，最小1 | 🟡 |

> 完整实体关系和枚举速查表见 [data-model.md](../data-model.md)

## 本模块的接口

| 方法 | 路径 | 说明 | 鉴权 |
|------|------|------|------|
| POST | /api/v1/orders | 创建订单 | 需登录 |
| GET | /api/v1/orders/{id} | 订单详情 | 需登录+本人 |

## 本模块的待解决问题

| 问题 | 关联代码 |
|------|---------|
| 退款超时逻辑不完整 | OrderService.java:200 |
```

### integrations.md（外部集成）

```markdown
# 外部集成

## 第三方服务

| 服务 | 用途 | 对接方式 | 关键类 | 置信度 |
|------|------|---------|--------|--------|
| 微信支付 | 支付 | HTTP API | WechatPayClient | 🟢 |
| 阿里云 OSS | 文件存储 | SDK | OssService | 🟢 |

## 消息队列

| 队列/Topic | 生产者 | 消费者 | 业务含义 | 置信度 |
|-----------|--------|--------|---------|--------|
| order.created | OrderService | NotifyService | 订单创建后通知 | 🟢 |

## 定时任务

| 任务 | 触发规则 | 业务含义 | 代码位置 | 置信度 |
|------|---------|---------|---------|--------|
| 订单超时关闭 | 每 5 分钟 | 关闭 30min 未支付订单 | OrderTask.java | 🟢 |

## 缓存策略

| 缓存 Key | 存储内容 | 过期时间 | 更新策略 | 置信度 |
|----------|---------|---------|---------|--------|
| user:{id} | 用户基本信息 | 30min | 更新时删除 | 🟡 |
```

### permissions.md（权限与安全）

```markdown
# 权限与安全

## 鉴权方式

> {JWT / Session / OAuth2 / ...} 🟢

## 角色定义

| 角色 | 说明 | 代码标识 |
|------|------|---------|
| 管理员 | 全部权限 | ADMIN |
| 普通用户 | 基本操作 | USER |

## 权限矩阵

| 操作 | 管理员 | 普通用户 | 访客 | 置信度 |
|------|--------|---------|------|--------|
| 创建订单 | ✅ | ✅ | ❌ | 🟢 |
| 删除用户 | ✅ | ❌ | ❌ | 🟢 |
```

### ai-guide.md（AI 开发指南）

```markdown
# AI 开发指南

## 必须遵守的业务规则

| # | 规则 | 原因 | 关联模块 |
|---|------|------|---------|
| 1 | 所有金额用 BigDecimal，不用 float/double | 精度问题 | 全局 |
| 2 | 删除操作一律软删除 | 数据审计需求 | 全局 |

## 容易踩的坑

| # | 坑 | 正确做法 | 关联代码 |
|---|---|---------|---------|
| 1 | Order.status 直接赋值 | 必须通过 OrderService.changeStatus() 触发状态机 | OrderService.java:50 |

## 命名约定

| 业务概念 | 代码命名 | 说明 |
|---------|---------|------|
| 用户 | User | 基础账号信息 |
| 会员 | Member | 会员体系扩展，通过 user_id 关联 User |
```

### open-questions.md（开放问题）

```markdown
# 开放问题

以下问题在问卷中未得到明确回答，开发时需注意。

| # | 问题 | 关联代码 | 影响范围 | 来源 |
|---|------|---------|---------|------|
| 1 | 退款超时后是否自动重试 | PaymentService.java:200 | 支付模块 | 问卷 v1 Q12 |
| 2 | User 和 Member 的同步时机 | UserService.java:80 | 用户模块 | 代码扫描 |
```
